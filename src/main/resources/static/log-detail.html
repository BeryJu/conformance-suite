<!--



-->
<html>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta charset="UTF-8">
    <title>Fintech IO : UI for Test Output : Log Detail</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="css/layout.css">

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>

    <script type="text/javascript" src="js/fapi.ui.js"></script>

    <body>

        <header onClick="FAPI_UI.goHome()"></header>

        <script type="text/template" id="logDetailTemplate">
            <div class="mainHolder">

                <div id="logDetail">
                    <h1>
                        <div class="row">
                            <div class="col-md-2 key">Log</div>
                            <div class="col-md-1 hyphen"></div>
                            <div class="col-md-9 value"><%- fileId %></div>
                        </div>
                    </h1>
              
                    <hr />
                    <div class="content">

                        <%
                            // repeat items 
                            _.each(items, function(item,arrIndex) {
                        %>
                            <div class="list">

                                <div class="item">

                                    <% if (item.src) { %>
                                        <div class="row">
                                            <div class="key">Source</div>
                                            <div class="hyphen"></div>
                                            <div class="value"><%- item.src %></div>
                                        </div>
                                    <%
                                    } 
                                    %>

                                    <% if (item.msg) { %>
                                        <div class="row">
                                            <div class="key">Message</div>
                                            <div class="hyphen"></div>
                                            <div class="value"><%- item.msg %></div>
                                        </div>
                                    <%
                                    } 
                                    %>

                                    <% if (item.requirements) { %>
                                        <div class="row">
                                            <div class="key">Requirements</div>
                                            <div class="hyphen"></div>
                                            <div class="value"><%- item.requirements %></div>
                                        </div>
                                    <%
                                    } 
                                    %>

                                    <% if (item.upload) { %>
                                        <div class="row">
                                            <div class="key">Upload</div>
                                            <div class="hyphen"></div>
                                            <div class="value"><%- item.upload %></div>
                                        </div>
                                    <%
                                    } 
                                    %>

                                    <% if (item.result) { // printing result details if we have them
                                        var layoutClasses = "";
                                        var itemResult = item.result.toUpperCase();

                                        if (itemResult) {
                                            layoutClasses = "label result-"+itemResult.toLowerCase();
                                        } else {
                                            layoutClasses = "label result-default";
                                        }  
                                    %>
                                        <div class="row">
                                            <div class="key">Result</div>
                                            <div class="hyphen"></div>
                                            <div class="<%- layoutClasses %>"><%- itemResult %></div>
                                        </div>
                                    <%
                                    } 
                                    %>

                                    <% if (item.time) { %>
                                        <div class="row">
                                            <div class="key">Time</div>
                                            <div class="hyphen"></div>
                                            <div class="value"><%- item.time %></div>
                                        </div>
                                    <%
                                    } 
                                    %>

                                    <% 
                                        // render any extra items which haven't been displayed yet
                                        var extraItems = 0;
                                        var extraItemsListing = "";
                                        _.each(Object.keys(item), function(key, index) {

                                            // this renders the toggle more button once we have counted how many extra items there are
                                            if (index == Object.keys(item).length-1 && extraItems > 0) {          
                                    %>
                                                <button onClick="toggleMore(this)" id="btn_<%- arrIndex %>" class="btn btn-default btn-xs pull-right">
                                                    <span class="badge"><%- extraItems %></span> More <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>  
                                                </button>
                                                <div class="moreinfo collapse wordwrap"><%- extraItemsListing %></div>
                                                <div class="clearfix"></div>
                                    <%
                                            }
                                            
                                            if (!_.contains(FAPI_UI.visibleFields, key)) {
                                                extraItems++;
                                                extraItemsListing += "<p/>"+key+ " : " + item[key];
                                            }
                                        });
                                    %>
                                    <hr/>
                                </div>
                            </div>
                        <%
                            });
                        %>
                    </div>
                </div>
            </div>
        </script>

        <div id="logDetailTemplate_render"></div>

        <script type="text/javascript">

            /**
             * 
             */
            $(document).ready(function(){
                var urlParams = new URLSearchParams(window.location.search);
                FAPI_UI.showLogDetail(urlParams.get('log'));
            });

            /**
             * 
             */
            function render(fileId, logs) {
                var template = _.template($("#logDetailTemplate").html());
                $('#logDetailTemplate_render').html(template({fileId:fileId, items:logs}));
            }

            /**
             * 
             */
            function toggleMore(btn) {

                var btnRef = "#"+btn.id;
       
                if ($(btnRef).hasClass('activated')) {
                    // it's already been activated, need to hide things
                    $($(btnRef).next()).hide(); // hide the content
                    $('.glyphicon', btnRef).removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
                    $(btnRef).removeClass('activated');
                } else {
                    // need to show the collapsed entity

                    // note Underscore has converted code for <p/>, need to convert back to what we expect for html
                    var myHTML = $(btnRef).next().html();
                    myHTML = myHTML.replace(/&lt;p\/&gt;/g, "<p/>");

                    $($(btnRef).next()).html(myHTML);
                    $($(btnRef).next()).show(); // show the content
                    $('.glyphicon', btnRef).removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
                    $(btnRef).addClass('activated');
                }
            }

        </script>


        <footer></footer>
        
    </body>

</html>