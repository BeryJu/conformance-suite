[
    {
        "test-name": "fapi1-advanced-final-discovery-end-point-verification",
        "variant": {
                "fapi_profile": "openbanking_uk"
        },
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "CheckJwksUriIsHostedOnOpenBankingDirectory",
        "expected-result": "warning",
        "comment": "this occurs on everything except production bank deployments"
    },
    {
        "test-name": "fapi1-advanced-final-attempt-reuse-authorisation-code-after-one-second",
        "variant": "*",
        "configuration-filename": "authlete*.json",
        "current-block": "Attempting reuse of authorisation code & testing if access token is revoked",
        "condition": "CallProtectedResourceWithBearerTokenExpectingError",
        "expected-result": "warning",
        "comment": "known case where authlete doesn't implement a 'should'"
    },
    {
        "test-name": "fapi1-advanced-final-refresh-token",
        "variant": {
                "client_auth_type": "private_key_jwt",
                "fapi_profile": "openbanking_uk",
                "fapi_response_mode": "plain_response"
        },
        "configuration-filename": "authlete-fapi-rw-id2-ob-privatekey.json",
        "current-block": "Second client: Check for refresh token",
        "condition": "FAPIEnsureServerConfigurationDoesNotSupportRefreshToken",
        "expected-result": "warning",
        "comment": "The second client in this configuration does not get issued a refresh token, which is now a warning"
    },
    {
        "test-name": "fapi1-advanced-final",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-*.json",
        "current-block": "",
        "condition": "FAPIBrazilMustTestUsingPayments",
        "expected-result": "warning",
        "comment": "The Authlete config we currently have is only good for accounts access"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "",
        "condition": "FAPIBrazilMustTestUsingPayments",
        "expected-result": "warning",
        "comment": "The Authlete config we currently have is only good for accounts access"
    },
    {
        "test-name": "oidcc-codereuse-30seconds",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "Testing if access token was revoked after the authorization code was reused",
        "condition": "CallProtectedResourceWithBearerTokenExpectingError",
        "expected-result": "warning",
        "comment": "known case where authlete doesn't implement a 'should'"
    },
    {
        "test-name": "oidcc-server-rotate-keys",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "VerifyNewJwksHasNewSigningKey",
        "expected-result": "failure",
        "comment": "CI can't trigger key rotation"
    },
    {
        "test-name": "oidcc-userinfo-post-body",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "UserInfoEndpointWithAccessTokenInBodyNotSupported",
        "expected-result": "warning",
        "comment": "Authlete doesn't support POST with access token in body, which is not required"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config.json",
        "current-block": "Verify token endpoint response",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-op-test-config-accounts.json",
        "current-block": "Use client_credentials grant to obtain Brazil consent",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-op-test-config-accounts.json",
        "current-block": "Verify token endpoint response",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": {
            "fapi_response_mode": "plain_response"
        },
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config.json",
        "current-block": "Verify authorization endpoint response",
        "condition": "ValidateIdTokenACRClaimAgainstRequest",
        "expected-result": "failure",
        "comment": "RP tests currently don't return requested acr values"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config.json",
        "current-block": "Verify token endpoint response",
        "condition": "ValidateIdTokenACRClaimAgainstRequest",
        "expected-result": "failure",
        "comment": "RP tests currently don't return requested acr values"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-op-test-config-accounts-dcr.json",
        "current-block": "",
        "condition": "FAPIBrazilMustTestUsingPayments",
        "expected-result": "warning",
        "comment": "This config uses accounts deliberately; the issue is only a warning"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-*.json",
        "current-block": "Use client_credentials grant to obtain Brazil consent",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-*.json",
        "current-block": "Verify token endpoint response",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow-variant",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow-variant",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "",
        "condition": "CheckScopesFromDynamicRegistrationEndpointDoNotExceedRequestedScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow-variant-2",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow-variant-2",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "",
        "condition": "CheckScopesFromDynamicRegistrationEndpointDoNotExceedRequestedScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-software-statement",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "EnsureHttpStatusCodeIs400",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-software-statement",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckDynamicRegistrationEndpointReturnedError",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-bad-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "EnsureHttpStatusCodeIs400or401",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-bad-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckDynamicRegistrationEndpointReturnedError",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-client-delete",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-client-delete",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Deleting client then expecting GET / DELETE on configuration endpoint to fail",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure",
        "comment": "Authlete seems to return wrong error code"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-client-delete",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Deleting client then expecting GET / DELETE on configuration endpoint to fail",
        "condition": "UnregisterDynamicallyRegisteredClientExpectingFailure",
        "expected-result": "failure",
        "comment": "Authlete seems to return wrong error code"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-invalid-registration-access-token",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-invalid-registration-access-token",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Calling GET / DELETE on configuration endpoint with invalid access token",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure",
        "comment": "Authlete seems to return wrong error code"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-invalid-registration-access-token",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Calling GET / DELETE on configuration endpoint with invalid access token",
        "condition": "UnregisterDynamicallyRegisteredClientExpectingFailure",
        "expected-result": "failure",
        "comment": "Authlete seems to return wrong error code"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Call client configuration endpoint with no certificate",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Call client configuration endpoint with no certificate",
        "condition": "CheckNoClientIdFromClientConfigurationEndpoint",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Call client configuration endpoint with no certificate",
        "condition": "UnregisterDynamicallyRegisteredClientExpectingFailure",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-no-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Call client configuration endpoint with no certificate",
        "condition": "UnregisterDynamicallyRegisteredClient",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be checking this"
    },
    {
        "test-name": "fapi1-advanced-final-brazil-dcr-bad-mtls",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "Authlete currently seems to not be returning 'scope'"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Retrieve client configuration",
        "condition": "CheckRedirectUrisFromClientConfigurationEndpoint",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-bad-jwks-uri",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-bad-jwks-uri",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Make PUT request to client configuration endpoint to change jwks uri to non-directory hosted one",
        "condition": "EnsureHttpStatusCodeIs400",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-bad-jwks-uri",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Make PUT request to client configuration endpoint to change jwks uri to non-directory hosted one",
        "condition": "CheckErrorFromDynamicRegistrationEndpointIsInvalidClientMetadata",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Try to change redirect uri using bad MTLS certificate",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Try to change redirect uri using bad MTLS certificate",
        "condition": "CheckNoClientIdFromClientConfigurationEndpoint",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Try to change redirect uri using no MTLS certificate",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Try to change redirect uri using no MTLS certificate",
        "condition": "CheckNoClientIdFromClientConfigurationEndpoint",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Calling PUT on configuration endpoint with invalid access token",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Calling PUT on configuration endpoint with no software statement assertion expecting failure",
        "condition": "EnsureHttpStatusCodeIs400",
        "expected-result": "failure"
    },

    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Calling PUT on configuration endpoint with software statement assertion with bad signature expecting failure",
        "condition": "EnsureHttpStatusCodeIs400",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Retrieve client configuration",
        "condition": "CheckRedirectUrisFromClientConfigurationEndpoint",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-invalid-jwks-by-value",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-invalid-jwks-by-value",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Make PUT request to client configuration endpoint to change jwks to one passed by value",
        "condition": "EnsureHttpStatusCodeIs400",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-invalid-jwks-by-value",
        "variant": "*",
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Make PUT request to client configuration endpoint to change jwks to one passed by value",
        "condition": "CheckErrorFromDynamicRegistrationEndpointIsInvalidClientMetadata",
        "expected-result": "failure"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-invalid-redirect-uri",
        "variant": {
            "client_auth_type": "mtls",
            "fapi_response_mode": "jarm",
            "fapi_auth_request_method": "pushed"
        },
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Perform Dynamic Client Registration",
        "condition": "CheckScopesFromDynamicRegistrationEndpointContainRequiredScopes",
        "expected-result": "failure",
        "comment": "**CHANGE ME** explain why this failure occurs"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-invalid-redirect-uri",
        "variant": {
            "client_auth_type": "mtls",
            "fapi_response_mode": "jarm",
            "fapi_auth_request_method": "pushed"
        },
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Make PUT request to client configuration endpoint to change redirect uri to one not in software statement",
        "condition": "EnsureHttpStatusCodeIs400",
        "expected-result": "failure",
        "comment": "**CHANGE ME** explain why this failure occurs"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-update-client-config-invalid-redirect-uri",
        "variant": {
            "client_auth_type": "mtls",
            "fapi_response_mode": "jarm",
            "fapi_auth_request_method": "pushed"
        },
        "configuration-filename": "authlete-fapi-brazil-dcr.json",
        "current-block": "Make PUT request to client configuration endpoint to change redirect uri to one not in software statement",
        "condition": "CheckErrorFromDynamicRegistrationEndpointIsInvalidRedirectUriOrInvalidClientMetadata",
        "expected-result": "failure",
        "comment": "**CHANGE ME** explain why this failure occurs"
    }
]
